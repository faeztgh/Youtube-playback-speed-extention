import{f as b}from"./chunks/badge-CCCdnOXL.js";function m(t){if(!t)return!1;try{const r=new URL(t).hostname.toLowerCase();return r==="youtu.be"||r.endsWith("youtube.com")}catch{return!1}}const l=!!chrome.storage.session,p="tab:";function T(t,o,r){(l?chrome.storage.session:chrome.storage.local).set({[t]:o},()=>r&&r())}function v(t,o){(l?chrome.storage.session:chrome.storage.local).get(t,i=>o(i[t]))}function h(){if(!l)try{chrome.storage.local.get(null,t=>{const o=Object.keys(t).filter(r=>r.startsWith(p));o.length&&chrome.storage.local.remove(o)})}catch{}}async function A(t){try{await chrome.tabs.sendMessage(t,{type:"GET_PLAYBACK_RATE"})}catch{}}async function c(t,o){const r=m(o);try{await chrome.action.enable(t),r?await A(t):await chrome.action.setBadgeText({tabId:t,text:""})}catch{}}chrome.runtime.onInstalled.addListener(()=>{h(),chrome.tabs.query({},t=>{for(const o of t)typeof o.id=="number"&&c(o.id,o.url??null)})});var d;(d=chrome.runtime.onStartup)==null||d.addListener(()=>{h(),chrome.tabs.query({},t=>{for(const o of t)typeof o.id=="number"&&c(o.id,o.url??null)})});chrome.tabs.onCreated.addListener(t=>{typeof t.id=="number"&&c(t.id,t.url??null)});chrome.tabs.onActivated.addListener(t=>{chrome.tabs.get(t.tabId,o=>{c(t.tabId,(o==null?void 0:o.url)??null)})});chrome.tabs.onUpdated.addListener((t,o,r)=>{(o.url||o.status==="complete")&&c(t,o.url??r.url??null)});chrome.runtime.onMessage.addListener((t,o,r)=>{var i,n,u,f;if((t==null?void 0:t.type)==="CURRENT_PLAYBACK_RATE"){const e=(i=o==null?void 0:o.tab)==null?void 0:i.id;if(typeof e=="number"){const a=b(t.rate);try{chrome.action.setBadgeBackgroundColor({tabId:e,color:"#111827"}),chrome.action.setBadgeTextColor&&chrome.action.setBadgeTextColor({tabId:e,color:"#FFFFFF"}),chrome.action.setBadgeText({tabId:e,text:a})}catch{}}}else if((t==null?void 0:t.type)==="GET_TAB_ID"){const e=((n=o==null?void 0:o.tab)==null?void 0:n.id)??null;r({tabId:e})}else if((t==null?void 0:t.type)==="SAVE_TAB_VIDEO_RATE"){const e=(u=o==null?void 0:o.tab)==null?void 0:u.id;if(typeof e=="number"){const a=`tab:${e}:video:${t.videoId}:rate`;return T(a,t.rate,()=>{r({ok:!0})}),!0}r({ok:!1})}else if((t==null?void 0:t.type)==="FETCH_TAB_VIDEO_RATE"){const e=(f=o==null?void 0:o.tab)==null?void 0:f.id;if(typeof e=="number"){const a=`tab:${e}:video:${t.videoId}:rate`;return v(a,y=>{r({rate:y})}),!0}r({rate:void 0})}});
