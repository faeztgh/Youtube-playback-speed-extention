function s(t){if(!t)return!1;try{const o=new URL(t).hostname.toLowerCase();return o==="youtu.be"||o.endsWith("youtube.com")}catch{return!1}}function l(t){const e=t<0?"-":"",o=Math.abs(t),r=Math.round(o*100)/100;let n=String(r);n.includes(".")&&(n=n.replace(/\.0+$/,"").replace(/(\.[0-9])0$/,"$1"));let i=`${e}${n}x`;if(i.length<=4)return i;const u=Math.round(o*10)/10;let d=String(u).replace(/\.0$/,"");return i=`${e}${d}x`,i.length<=4?i:`${e}${Math.round(o)}`}async function h(t){try{await chrome.tabs.sendMessage(t,{type:"GET_PLAYBACK_RATE"})}catch{}}async function a(t,e){const o=s(e);try{await chrome.action.enable(t),o?await h(t):await chrome.action.setBadgeText({tabId:t,text:""})}catch{}}chrome.runtime.onInstalled.addListener(()=>{chrome.tabs.query({},t=>{for(const e of t)typeof e.id=="number"&&a(e.id,e.url??null)})});var c;(c=chrome.runtime.onStartup)==null||c.addListener(()=>{chrome.tabs.query({},t=>{for(const e of t)typeof e.id=="number"&&a(e.id,e.url??null)})});chrome.tabs.onCreated.addListener(t=>{typeof t.id=="number"&&a(t.id,t.url??null)});chrome.tabs.onActivated.addListener(t=>{chrome.tabs.get(t.tabId,e=>{a(t.tabId,(e==null?void 0:e.url)??null)})});chrome.tabs.onUpdated.addListener((t,e,o)=>{(e.url||e.status==="complete")&&a(t,e.url??o.url??null)});chrome.runtime.onMessage.addListener((t,e)=>{var o;if((t==null?void 0:t.type)==="CURRENT_PLAYBACK_RATE"){const r=(o=e==null?void 0:e.tab)==null?void 0:o.id;if(typeof r=="number"){const n=l(t.rate);try{chrome.action.setBadgeBackgroundColor({tabId:r,color:"#111827"}),chrome.action.setBadgeTextColor&&chrome.action.setBadgeTextColor({tabId:r,color:"#FFFFFF"}),chrome.action.setBadgeText({tabId:r,text:n})}catch{}}}});
