import{f as d}from"./chunks/badge-CCCdnOXL.js";function l(t){if(!t)return!1;try{const o=new URL(t).hostname.toLowerCase();return o==="youtu.be"||o.endsWith("youtube.com")}catch{return!1}}const c=!!chrome.storage.session,u="tab:";function f(t,e,o){(c?chrome.storage.session:chrome.storage.local).set({[t]:e},()=>o&&o())}function m(t,e){(c?chrome.storage.session:chrome.storage.local).get(t,r=>e(r[t]))}function n(){if(!c)try{chrome.storage.local.get(null,t=>{const e=Object.keys(t).filter(o=>o.startsWith(u));e.length&&chrome.storage.local.remove(e)})}catch{}}async function h(t){try{await chrome.tabs.sendMessage(t,{type:"GET_PLAYBACK_RATE"})}catch{}}async function i(t,e){const o=l(e);try{await chrome.action.enable(t),o?await h(t):await chrome.action.setBadgeText({tabId:t,text:""})}catch{}}chrome.runtime.onInstalled.addListener(()=>{n(),chrome.tabs.query({},t=>{for(const e of t)typeof e.id=="number"&&i(e.id,e.url??null)})});chrome.runtime.onStartup?.addListener(()=>{n(),chrome.tabs.query({},t=>{for(const e of t)typeof e.id=="number"&&i(e.id,e.url??null)})});chrome.tabs.onCreated.addListener(t=>{typeof t.id=="number"&&i(t.id,t.url??null)});chrome.tabs.onActivated.addListener(t=>{chrome.tabs.get(t.tabId,e=>{i(t.tabId,e?.url??null)})});chrome.tabs.onUpdated.addListener((t,e,o)=>{(e.url||e.status==="complete")&&i(t,e.url??o.url??null)});chrome.runtime.onMessage.addListener((t,e,o)=>{if(t?.type==="CURRENT_PLAYBACK_RATE"){const r=e?.tab?.id;if(typeof r=="number"){const a=d(t.rate);try{chrome.action.setBadgeBackgroundColor({tabId:r,color:"#111827"}),chrome.action.setBadgeTextColor&&chrome.action.setBadgeTextColor({tabId:r,color:"#FFFFFF"}),chrome.action.setBadgeText({tabId:r,text:a})}catch{}}}else if(t?.type==="GET_TAB_ID"){const r=e?.tab?.id??null;o({tabId:r})}else if(t?.type==="SAVE_TAB_VIDEO_RATE"){const r=e?.tab?.id;if(typeof r=="number"){const a=`tab:${r}:video:${t.videoId}:rate`;return f(a,t.rate,()=>{o({ok:!0})}),!0}o({ok:!1})}else if(t?.type==="FETCH_TAB_VIDEO_RATE"){const r=e?.tab?.id;if(typeof r=="number"){const a=`tab:${r}:video:${t.videoId}:rate`;return m(a,s=>{o({rate:s})}),!0}o({rate:void 0})}});
