import{f as h}from"./chunks/badge-CCCdnOXL.js";function y(t){if(!t)return!1;try{const r=new URL(t).hostname.toLowerCase();return r==="youtu.be"||r.endsWith("youtube.com")}catch{return!1}}async function b(t){try{await chrome.tabs.sendMessage(t,{type:"GET_PLAYBACK_RATE"})}catch{}}async function u(t,o){const r=y(o);try{await chrome.action.enable(t),r?await b(t):await chrome.action.setBadgeText({tabId:t,text:""})}catch{}}chrome.runtime.onInstalled.addListener(()=>{chrome.tabs.query({},t=>{for(const o of t)typeof o.id=="number"&&u(o.id,o.url??null)})});var l;(l=chrome.runtime.onStartup)==null||l.addListener(()=>{chrome.tabs.query({},t=>{for(const o of t)typeof o.id=="number"&&u(o.id,o.url??null)})});chrome.tabs.onCreated.addListener(t=>{typeof t.id=="number"&&u(t.id,t.url??null)});chrome.tabs.onActivated.addListener(t=>{chrome.tabs.get(t.tabId,o=>{u(t.tabId,(o==null?void 0:o.url)??null)})});chrome.tabs.onUpdated.addListener((t,o,r)=>{(o.url||o.status==="complete")&&u(t,o.url??r.url??null)});chrome.runtime.onMessage.addListener((t,o,r)=>{var a,e,n,d;if((t==null?void 0:t.type)==="CURRENT_PLAYBACK_RATE"){const i=(a=o==null?void 0:o.tab)==null?void 0:a.id;if(typeof i=="number"){const c=h(t.rate);try{chrome.action.setBadgeBackgroundColor({tabId:i,color:"#111827"}),chrome.action.setBadgeTextColor&&chrome.action.setBadgeTextColor({tabId:i,color:"#FFFFFF"}),chrome.action.setBadgeText({tabId:i,text:c})}catch{}}}else if((t==null?void 0:t.type)==="GET_TAB_ID"){const i=((e=o==null?void 0:o.tab)==null?void 0:e.id)??null;r({tabId:i})}else if((t==null?void 0:t.type)==="SAVE_TAB_VIDEO_RATE"){const i=(n=o==null?void 0:o.tab)==null?void 0:n.id;if(typeof i=="number"){const c=`tab:${i}:video:${t.videoId}:rate`;return chrome.storage.session.set({[c]:t.rate},()=>{r({ok:!0})}),!0}r({ok:!1})}else if((t==null?void 0:t.type)==="FETCH_TAB_VIDEO_RATE"){const i=(d=o==null?void 0:o.tab)==null?void 0:d.id;if(typeof i=="number"){const c=`tab:${i}:video:${t.videoId}:rate`;return chrome.storage.session.get(c,f=>{r({rate:f[c]})}),!0}r({rate:void 0})}});
