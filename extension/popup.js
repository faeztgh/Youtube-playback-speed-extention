import{j as t,r as u,g as C,s as x,D as f,S as _,P as O,o as U,H as q,a as D,A as W,b as H,c as Y}from"./chunks/PresetList-D44a_KDF.js";import{f as k}from"./chunks/badge-CCCdnOXL.js";const G=({mode:e})=>e==="light"?t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M12 4V2M12 22v-2M4 12H2M22 12h-2M5.64 5.64 4.22 4.22M19.78 19.78l-1.42-1.42M18.36 5.64l1.42-1.42M4.22 19.78l1.42-1.42",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),t.jsx("circle",{cx:"12",cy:"12",r:"4.5",stroke:"currentColor",strokeWidth:"1.5"})]}):e==="dark"?t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z",stroke:"currentColor",strokeWidth:"1.5",fill:"currentColor"})}):t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),t.jsx("path",{d:"M3 15h18",stroke:"currentColor",strokeWidth:"1.5"})]}),J=({value:e,onChange:a,className:s})=>{const n=["system","light","dark"];return t.jsx("div",{className:(s??"")+" flex items-center gap-1 rounded-lg border border-white/20 bg-white/10 p-0.5",role:"group","aria-label":"Theme",children:n.map(r=>{const l=e===r;return t.jsx("button",{type:"button","aria-pressed":l,onClick:()=>a(r),className:"w-8 h-8 grid place-items-center rounded-md text-white/85 transition "+(l?"bg-white !text-[#0f0f0f] shadow ring-1 ring-white/50":"hover:bg-white/10 active:bg-white/20"),title:r[0].toUpperCase()+r.slice(1),"aria-label":r,children:t.jsx(G,{mode:r})},r)})})},K=({tabs:e,value:a,onChange:s,className:n})=>t.jsx("div",{className:(n??"")+" flex gap-1 bg-neutral-100 dark:bg-neutral-900 p-1 rounded-lg border border-neutral-200 dark:border-neutral-800",children:e.map(r=>{const l=r.key===a;return t.jsx("button",{onClick:()=>s(r.key),className:"px-3 py-1.5 rounded-md text-sm transition "+(l?"bg-white dark:bg-neutral-800 shadow border border-neutral-200 dark:border-neutral-700":"hover:bg-white/60 dark:hover:bg-neutral-800/60"),"aria-selected":l,role:"tab",children:t.jsxs("span",{className:"flex items-center gap-2",children:[r.icon,t.jsx("span",{children:r.label})]})},r.key)})}),$=()=>{const[e,a]=u.useState(null),s=u.useRef(null);if(u.useEffect(()=>{C().then(a)},[]),!e)return null;const n=async()=>{const c=JSON.stringify(e,null,2),i=new Blob([c],{type:"application/json"}),h=URL.createObjectURL(i),g=document.createElement("a");g.href=h,g.download="media-controller-settings.json",g.click(),URL.revokeObjectURL(h)},r=async c=>{const i=await c.text(),h=JSON.parse(i);await x(h),a(h)},l=async()=>{await x(f),a(f)};return t.jsxs("div",{className:"mt-3 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:e.rememberLastPerChannel,onChange:async c=>{const i={rememberLastPerChannel:c.target.checked};await x(i),a({...e,...i})}}),t.jsx("span",{children:"Remember last used speed per channel"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:e.overlay.visible||e.showOverlay,onChange:async c=>{const i={overlay:{...e.overlay,visible:c.target.checked},showOverlay:c.target.checked};await x(i),a({...e,...i})}}),t.jsx("span",{children:"Show in-player controller overlay"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:e.overlay.autoHide,onChange:async c=>{const i={overlay:{...e.overlay,autoHide:c.target.checked}};await x(i),a({...e,...i})}}),t.jsx("span",{children:"Auto-hide overlay until hovered"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:n,children:"Export settings"}),t.jsx("input",{ref:s,type:"file",accept:"application/json",className:"hidden",onChange:c=>c.target.files&&r(c.target.files[0])}),t.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:()=>{var c;return(c=s.current)==null?void 0:c.click()},children:"Import settings"}),t.jsx("button",{className:"ml-auto px-3 py-2 rounded-md border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-700 dark:text-red-300",onClick:l,children:"Reset to defaults"})]})]})},V={default:"border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 hover:bg-gray-50 dark:hover:bg-neutral-800",danger:"border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-700 dark:text-red-300",success:"border border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/20 hover:bg-emerald-100 dark:hover:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300"};function p({variant:e="default",className:a="",children:s,...n}){const r="px-3 py-1.5 rounded-md transition active:scale-[.98] disabled:opacity-50 disabled:cursor-not-allowed",l=V[e];return t.jsx("button",{className:`${r} ${l} ${a}`,...n,children:s})}function z({children:e,className:a=""}){return t.jsx("div",{className:`p-5 rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 shadow-sm ${a}`,children:e})}const Q=e=>{const a=e.rates.length?Math.min(.1,...e.rates):.1,s=e.rates.length?Math.max(4,...e.rates):4;return t.jsxs("div",{className:"mt-3",children:[t.jsx(z,{className:"hover:shadow-md",children:t.jsx(_,{min:a,max:s,value:e.sliderRate,onChange:async n=>{e.setSliderRate(n),await e.apply(n)},onClear:async()=>{e.setSliderRate(e.defaultRate),await e.apply(e.defaultRate)}})}),t.jsxs("div",{className:"mt-4",children:[t.jsx(O,{presets:e.rates,onSelect:async n=>{e.setSliderRate(n),await e.apply(n)},onRemove:e.removeRate,currentRate:e.sliderRate}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsx("input",{type:"number",step:"0.05",placeholder:"Custom speed (e.g. 1.25)",value:e.customRateInput,onChange:n=>e.setCustomRateInput(n.target.value),onKeyDown:n=>{n.key==="Enter"&&e.addCustomRate()},className:"flex-1 px-3 py-2 bg-white border border-gray-200 rounded-md dark:border-neutral-800 dark:bg-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-300 dark:focus:ring-neutral-700",inputMode:"decimal","aria-label":"Custom speed"}),t.jsx(p,{onClick:e.addCustomRate,children:"Add"}),t.jsx(p,{onClick:e.addRate,children:"+0.25"})]})]}),t.jsx("div",{className:"flex items-center gap-2 mt-4",children:t.jsx("div",{className:"ml-auto",children:t.jsx(p,{onClick:e.onSave,children:"Save"})})})]})},X=[.25,.5,.75,1,1.25,1.5,1.75,2];function Z(e){const a=X,s=Math.min(a[a.length-1],Math.max(a[0],e));return a.reduce((n,r)=>Math.abs(r-s)<Math.abs(n-s)?r:n,a[0])}function ee(){const e=document.querySelector("video.html5-main-video");return e&&!Number.isNaN(e.playbackRate)?e:document.querySelector("video")}function T(e){return e.__reverseController??null}function N(e,a){e.__reverseController=a}function v(e){const a=T(e);a!=null&&a.rafId&&cancelAnimationFrame(a.rafId),N(e,null)}function te(e,a){v(e);const s={rafId:null,lastTimestampMs:null,speedAbs:a};N(e,s);try{e.pause()}catch{}const n=r=>{if(!document.contains(e)){v(e);return}const l=T(e);if(!l)return;const c=l.lastTimestampMs??r,i=Math.min(.25,Math.max(0,(r-c)/1e3));l.lastTimestampMs=r;const h=i*l.speedAbs,g=Math.max(0,e.currentTime-h);e.currentTime=g,l.rafId=requestAnimationFrame(n)};s.rafId=requestAnimationFrame(n)}function ae(e){const a=ee();if(!a)return!1;if(e<0){const n=Math.abs(e);return a.playbackRate=0,te(a,n),a.dispatchEvent(new Event("ratechange")),!0}v(a);const s=Z(e);return a.playbackRate=s,a.dispatchEvent(new Event("ratechange")),!0}async function re(e){var a;try{if((a=chrome==null?void 0:chrome.tabs)!=null&&a.query){const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});if(s!=null&&s.id)try{await chrome.tabs.sendMessage(s.id,{type:"SET_PLAYBACK_RATE",rate:e}),await chrome.action.setBadgeBackgroundColor({tabId:s.id,color:"#111827"}),chrome.action.setBadgeTextColor&&await chrome.action.setBadgeTextColor({tabId:s.id,color:"#FFFFFF"}),await chrome.action.setBadgeText({tabId:s.id,text:k(e)});return}catch{try{await chrome.scripting.executeScript({target:{tabId:s.id},func:n=>{const r=document.querySelector("video");r&&(r.playbackRate=n,r.dispatchEvent(new Event("ratechange")))},args:[e]}),await chrome.action.setBadgeBackgroundColor({tabId:s.id,color:"#111827"}),chrome.action.setBadgeTextColor&&await chrome.action.setBadgeTextColor({tabId:s.id,color:"#FFFFFF"}),await chrome.action.setBadgeText({tabId:s.id,text:k(e)});return}catch{}}}}catch{}ae(e)}function R(e){return Math.round(e*100)/100}const se=()=>{const[e,a]=u.useState(f.customRates),[s,n]=u.useState(f.defaultPlaybackRate),[r,l]=u.useState(f.theme??"system"),[c,i]=u.useState(f.defaultPlaybackRate),[h,g]=u.useState(""),[y,S]=u.useState("general"),[w,M]=u.useState(null),j=u.useRef(null);u.useEffect(()=>{j.current=w},[w]),u.useEffect(()=>{(async()=>{const o=await C();a(o.customRates),n(o.defaultPlaybackRate),l(o.theme??"system"),i(o.defaultPlaybackRate||1);const[d]=await chrome.tabs.query({active:!0,currentWindow:!0});if(M((d==null?void 0:d.id)??null),d!=null&&d.id)try{await chrome.tabs.sendMessage(d.id,{type:"GET_PLAYBACK_RATE"})}catch{}})()},[]),u.useEffect(()=>{const o=document.documentElement,d=r==="dark"||r==="system"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;o.classList.toggle("dark",d)},[r]),u.useEffect(()=>{U((o,d)=>{var m;if(o.type==="CURRENT_PLAYBACK_RATE"){const b=((m=d.tab)==null?void 0:m.id)??null;b&&b===j.current&&(i(o.rate),n(o.rate),(async()=>{try{await chrome.action.setBadgeBackgroundColor({tabId:b,color:"#111827"}),chrome.action.setBadgeTextColor&&await chrome.action.setBadgeTextColor({tabId:b,color:"#FFFFFF"}),await chrome.action.setBadgeText({tabId:b,text:k(o.rate)})}catch{}})())}})},[]);async function E(o){await H({type:"PAUSE_AUTOMATION",ms:1e4}),await re(o),x({defaultPlaybackRate:o})}async function A(){await x({customRates:e,defaultPlaybackRate:s,theme:r})}const I=()=>a(o=>Array.from(new Set([...o,R((o[o.length-1]??1)+.25)])).sort((d,m)=>d-m)),B=()=>{const o=Number(h);if(!Number.isFinite(o)||o<=0)return;const d=R(o);a(m=>Array.from(new Set([...m,d])).sort((b,L)=>b-L)),g("")},F=o=>{a(d=>d.filter(m=>m!==o).sort((m,b)=>m-b))},P=[{key:"general",label:"General"},{key:"profiles",label:"Profiles"},{key:"automation",label:"Automation"},{key:"settings",label:"Settings"}];return t.jsxs("div",{className:"min-w-[650px] p-0 font-sans text-neutral-900 dark:text-neutral-100 bg-white dark:bg-neutral-950",children:[t.jsxs("div",{className:"px-4 py-3 mb-0 bg-[#0f0f0f] text-white flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col leading-tight",children:[t.jsx("span",{className:"text-sm opacity-80",children:"Playback Controller"}),t.jsx("h3",{className:"m-0 text-lg font-semibold tracking-wide",children:"Media Controls"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("a",{href:"https://hamibash.com/faez",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/20 text-white text-sm border border-white/15 transition active:scale-[.98]",children:[t.jsx(q,{className:"w-4 h-4"}),t.jsx("span",{children:"Support"})]}),t.jsx(J,{value:r,onChange:l})]})]}),t.jsxs("div",{className:"p-4 pt-3",children:[t.jsx(K,{tabs:P,value:y,onChange:S}),y==="general"&&t.jsx(Q,{rates:e,sliderRate:c,setSliderRate:i,defaultRate:s,apply:E,onSave:A,removeRate:F,customRateInput:h,setCustomRateInput:g,addCustomRate:B,addRate:I}),y==="profiles"&&t.jsx(D,{}),y==="automation"&&t.jsx(W,{}),y==="settings"&&t.jsx($,{})]})]})},ne=Y(document.getElementById("root"));ne.render(t.jsx(se,{}));
